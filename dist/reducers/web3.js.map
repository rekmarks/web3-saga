{"version":3,"sources":["../../src/reducers/web3.js"],"names":["watchGetWeb3","getWeb3Saga","initialState","account","networkId","provider","ready","errors","sagas","ACTIONS","GET_WEB3","_test","actions","getWeb3Action","getWeb3FailureAction","getWeb3SuccessAction","getClearErrorsAction","reducer","state","action","type","GET_WEB3_SUCCESS","GET_WEB3_FAILURE","concat","error","CLEAR_ERRORS","window","ethereum","isMetaMask","selectedAddress","networkVersion","console","warn","Error","length"],"mappings":";;;;;;;;;;;;;;;;;;AAGA;;AAIA;;;;wBA6HWA,Y;;;wBAUAC,W;;;;;;AArIX,IAAMC,YAAY,GAAG;AACnBC,EAAAA,OAAO,EAAE,IADU;AACJ;AACfC,EAAAA,SAAS,EAAE,IAFQ;AAEF;AACjBC,EAAAA,QAAQ,EAAE,IAHS;AAGH;AAChBC,EAAAA,KAAK,EAAE,KAJY;AAIL;AACdC,EAAAA,MAAM,EAAE,EALW,CAKP;;AALO,CAArB;;AAQA,IAAMC,KAAK,GAAG,CACZ,yBAAWC,cAAQC,QAAnB,EAA6BT,WAA7B,CADY,CAAd;;AAIA,IAAMU,KAAK,GAAG;AACZC,EAAAA,OAAO,EAAE;AACPC,IAAAA,aAAa,EAAbA,aADO;AAEPC,IAAAA,oBAAoB,EAApBA,oBAFO;AAGPC,IAAAA,oBAAoB,EAApBA,oBAHO;AAIPC,IAAAA,oBAAoB,EAApBA;AAJO,GADG;AAOZR,EAAAA,KAAK,EAAE;AACLP,IAAAA,WAAW,EAAXA,WADK;AAELD,IAAAA,YAAY,EAAZA;AAFK;AAPK,CAAd;;;AAqBe,SAASiB,OAAT,GAAgD;AAAA,MAA9BC,KAA8B,uEAAtBhB,YAAsB;AAAA,MAARiB,MAAQ;;AAE7D,UAAQA,MAAM,CAACC,IAAf;AAEE,SAAKX,cAAQC,QAAb;AACE,+BACKR,YADL;;AAIF,SAAKO,cAAQY,gBAAb;AACE,+BACKH,KADL;AAEEZ,QAAAA,KAAK,EAAE,IAFT;AAGED,QAAAA,QAAQ,EAAEc,MAAM,CAACd,QAHnB;AAIEF,QAAAA,OAAO,EAAEgB,MAAM,CAAChB,OAJlB;AAKEC,QAAAA,SAAS,EAAEe,MAAM,CAACf;AALpB;;AAQF,SAAKK,cAAQa,gBAAb;AACE,+BACKJ,KADL;AAEEX,QAAAA,MAAM,EAAEW,KAAK,CAACX,MAAN,CAAagB,MAAb,CAAoBJ,MAAM,CAACK,KAA3B;AAFV;;AAKF,SAAKf,cAAQgB,YAAb;AACE,+BACKP,KADL;AAEEX,QAAAA,MAAM,EAAE;AAFV;;AAKF;AACE,aAAOW,KAAP;AA7BJ;AA+BD;AAED;;;;AAIA;;;;;AAGA,SAASL,aAAT,GAA0B;AACxB,SAAO;AACLO,IAAAA,IAAI,EAAEX,cAAQC;AADT,GAAP;AAGD;AAED;;;;;;;;AAMA,SAASK,oBAAT,CAA+BV,QAA/B,EAAyCF,OAAzC,EAAkDC,SAAlD,EAA6D;AAC3D,SAAO;AACLgB,IAAAA,IAAI,EAAEX,cAAQY,gBADT;AAELhB,IAAAA,QAAQ,EAARA,QAFK;AAGLF,IAAAA,OAAO,EAAPA,OAHK;AAILC,IAAAA,SAAS,EAATA;AAJK,GAAP;AAMD;AAED;;;;;;AAIA,SAASU,oBAAT,CAA+BU,KAA/B,EAAsC;AACpC,SAAO;AACLJ,IAAAA,IAAI,EAAEX,cAAQa,gBADT;AAELE,IAAAA,KAAK,EAALA;AAFK,GAAP;AAID;AAED;;;;;AAGA,SAASR,oBAAT,GAAiC;AAC/B,SAAO;AACLI,IAAAA,IAAI,EAAEX,cAAQgB;AADT,GAAP;AAGD;AAED;;;;AAIA;;;;;AAGA,SAAWzB,YAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AACE,iBAAM,yBAAWS,cAAQC,QAAnB,EAA6BT,WAA7B,CAAN;;AADF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;;;;;;;;AAMA,SAAWA,WAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAMMyB,MAAM,CAACC,QAAP,IAAmBD,MAAM,CAACC,QAAP,CAAgBC,UANzC;AAAA;AAAA;AAAA;;AAAA;AASM;AACAvB,UAAAA,QAAQ,GAAGqB,MAAM,CAACC,QAAlB;AACAxB,UAAAA,OAAO,GAAGuB,MAAM,CAACC,QAAP,CAAgBE,eAA1B;AACAzB,UAAAA,SAAS,GAAGsB,MAAM,CAACC,QAAP,CAAgBG,cAA5B;AAZN;AAAA;;AAAA;AAAA;AAAA;AAAA;AAeM,iBAAM,kBAAIhB,oBAAoB,cAAxB,CAAN;;AAfN;AAAA;AAAA;;AAAA;AAkBIiB,UAAAA,OAAO,CAACC,IAAR,CAAa,0BAAb;AAlBJ;AAmBI,iBAAM,kBAAIlB,oBAAoB,CAAC,IAAImB,KAAJ,CAAU,4BAAV,CAAD,CAAxB,CAAN;;AAnBJ;AAAA,gBAuBM,CAAC9B,OAAD,IAAYA,OAAO,CAAC+B,MAAR,GAAiB,CAA7B,IAAkC,CAAC9B,SAvBzC;AAAA;AAAA;AAAA;;AAAA;AAwBI,iBAAM,kBAAIU,oBAAoB,CAAC,IAAImB,KAAJ,CAC7B,2CAD6B,EACgB9B,OADhB,CAAD,CAAxB,CAAN;;AAxBJ;AAAA;AAAA;;AAAA;AAAA;AA2BI,iBAAM,kBAAIY,oBAAoB,CAACV,QAAD,EAAWF,OAAX,EAAoBC,SAApB,CAAxB,CAAN;;AA3BJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA","sourcesContent":["\n// package imports\n\nimport { put, takeLatest } from 'redux-saga/effects'\n\n// local imports\n\nimport { web3 as ACTIONS } from '../actions'\n\nconst initialState = {\n  account: null, // current selected account from injected web3 object\n  networkId: null, // current selected network id from injected web3 object\n  provider: null, // current provider from injected web3 object\n  ready: false, // false on start or if any thunks have yet to return, true o.w.\n  errors: [], // storage for web3 errors\n}\n\nconst sagas = [\n  takeLatest(ACTIONS.GET_WEB3, getWeb3Saga),\n]\n\nconst _test = {\n  actions: {\n    getWeb3Action,\n    getWeb3FailureAction,\n    getWeb3SuccessAction,\n    getClearErrorsAction,\n  },\n  sagas: {\n    getWeb3Saga,\n    watchGetWeb3,\n  },\n}\n\nexport {\n  getWeb3Action as getWeb3,\n  getClearErrorsAction as clearErrors,\n  initialState,\n  sagas,\n  _test,\n}\n\nexport default function reducer (state = initialState, action) {\n\n  switch (action.type) {\n\n    case ACTIONS.GET_WEB3:\n      return {\n        ...initialState,\n      }\n\n    case ACTIONS.GET_WEB3_SUCCESS:\n      return {\n        ...state,\n        ready: true,\n        provider: action.provider,\n        account: action.account,\n        networkId: action.networkId,\n      }\n\n    case ACTIONS.GET_WEB3_FAILURE:\n      return {\n        ...state,\n        errors: state.errors.concat(action.error),\n      }\n\n    case ACTIONS.CLEAR_ERRORS:\n      return {\n        ...state,\n        errors: [],\n      }\n\n    default:\n      return state\n  }\n}\n\n/**\n * Synchronous action creators\n */\n\n/**\n * Gets web3, adds it to state.\n */\nfunction getWeb3Action () {\n  return {\n    type: ACTIONS.GET_WEB3,\n  }\n}\n\n/**\n * On getWeb3 success, adds provider, account, and networkId to state.\n * @param {object} provider\n * @param {string} account\n * @param {string} networkId\n */\nfunction getWeb3SuccessAction (provider, account, networkId) {\n  return {\n    type: ACTIONS.GET_WEB3_SUCCESS,\n    provider,\n    account,\n    networkId,\n  }\n}\n\n/**\n * On getWeb3 failure, adds error to state.\n * @param {error} error\n */\nfunction getWeb3FailureAction (error) {\n  return {\n    type: ACTIONS.GET_WEB3_FAILURE,\n    error,\n  }\n}\n\n/**\n * Clears errors from state.\n */\nfunction getClearErrorsAction () {\n  return {\n    type: ACTIONS.CLEAR_ERRORS,\n  }\n}\n\n/**\n * Sagas\n */\n\n/**\n * Watcher for getWeb3Saga.\n */\nfunction * watchGetWeb3 () {\n  yield takeLatest(ACTIONS.GET_WEB3, getWeb3Saga)\n}\n\n/**\n * Saga. Gets the injected web3 object. Assumes window.ethereum.enable()\n * already called. Does not support legacy dapp browsers.\n *\n * TODO: Add support for other EIP1102-compliant dapp browsers.\n */\nfunction * getWeb3Saga () {\n\n  let provider, account, networkId\n\n  // attempt to get ethereum object injected by MetaMask\n  // TODO: let other dapp browsers through, but add a warning in the UI\n  if (window.ethereum && window.ethereum.isMetaMask) {\n\n    try {\n      // Request account access if needed\n      provider = window.ethereum\n      account = window.ethereum.selectedAddress\n      networkId = window.ethereum.networkVersion\n    } catch (error) {\n      // User denied access\n      yield put(getWeb3FailureAction(error))\n    }\n  } else {\n    console.warn('Please install MetaMask.')\n    yield put(getWeb3FailureAction(new Error('window.ethereum not found.')))\n  }\n\n  // fail if account invalid\n  if (!account || account.length < 1 || !networkId) {\n    yield put(getWeb3FailureAction(new Error(\n      'Missing or invalid account or network id.', account)))\n  } else {\n    yield put(getWeb3SuccessAction(provider, account, networkId))\n  }\n}\n"],"file":"web3.js"}